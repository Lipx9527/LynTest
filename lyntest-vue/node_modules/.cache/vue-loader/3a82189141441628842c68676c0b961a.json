{"remainingRequest":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyn/Desktop/lyntest/lyntest-vue/src/view/admin/user/user-info.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/src/view/admin/user/user-info.vue","mtime":1608859526901},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Admin from '@/lin/model/admin'\nimport User from '@/lin/model/user'\n\nexport default {\n  props: {\n    submit: {\n      type: Boolean, // 表单是否显示功能按钮\n      default: true,\n    },\n    id: {\n      // 用户id\n      type: Number,\n      default: undefined,\n    },\n    groups: {\n      // 所有分组\n      type: Array,\n      default: () => {},\n    },\n    labelPosition: {\n      // 表单label位置\n      type: String,\n      default: 'right',\n    },\n    info: {\n      // 用户信息\n      type: Object,\n      default: () => {},\n    },\n    pageType: {\n      type: String,\n      default: 'add', // 区分编辑页面/添加页面\n    },\n  },\n  inject: ['eventBus'],\n  data() {\n    // 验证回调函数\n    const checkUserName = (rule, value, callback) => {\n      // eslint-disable-line\n      if (!value) {\n        callback(new Error('用户名不能为空'))\n      }\n      callback()\n    }\n    const validateCode = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error('工号不能为空'))\n      }\n      callback()\n    }\n    const validatePassword = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请输入密码'))\n      } else if (value.length < 6) {\n        callback(new Error('密码长度不能少于6位数'))\n      } else {\n        if (this.form.checkPassword !== '') {\n          this.$refs.form.validateField('confirm_password')\n        }\n        callback()\n      }\n    }\n    const validatePassword2 = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请再次输入密码'))\n      } else if (value !== this.form.password) {\n        callback(new Error('两次输入密码不一致!'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      loading: false, // 加载动画\n      isEdited: false, // 能否编辑\n      form: {\n        username: '',\n        password: '',\n        confirm_password: '',\n        code: '',\n        group_ids: [],\n      },\n      // 验证规则\n      rules: {\n        username: [\n          {\n            validator: checkUserName,\n            trigger: ['blur', 'change'],\n            required: true,\n          },\n        ],\n        password: [{ validator: validatePassword, trigger: 'blur', required: true }],\n        confirm_password: [{ validator: validatePassword2, trigger: 'blur', required: true }],\n        code: [{ validator: validateCode, trigger: 'blur', required: true },\n        ],\n      },\n    }\n  },\n  methods: {\n    // 提交表单\n    async submitForm(formName) {\n      this.$refs[formName].validate(async valid => {\n        // eslint-disable-line\n        if (valid) {\n          // 新增用户\n          let res\n          if (this.pageType === 'add') {\n            try {\n              this.loading = true\n              res = await User.register(this.form)\n              if (res.code < window.MAX_SUCCESS_CODE) {\n                this.loading = false\n                this.$message.success(`${res.message}`)\n                this.eventBus.$emit('addUser', true)\n                this.resetForm(formName)\n              }\n            } catch (e) {\n              this.loading = false\n              if (e.data.code === 10073 || e.data.code === 10071) {\n                this.$message.error(e.data.message)\n              } else {\n                this.$message.error('新增用户失败')\n              }\n            }\n          } else {\n            // 更新用户信息\n            if (\n              this.form.code === this.info.code\n              && this.form.group_ids.sort().toString() === this.info.group_ids.sort().toString()\n            ) {\n              this.$emit('handleInfoResult', false)\n              return\n            }\n            try {\n              this.loading = true\n              res = await Admin.updateOneUser(this.form.code, this.form.group_ids, this.id)\n            } catch (e) {\n              this.loading = false\n              console.log(e)\n            }\n            if (res.code < window.MAX_SUCCESS_CODE) {\n              this.loading = false\n              this.$message.success(`${res.message}`)\n              this.$emit('handleInfoResult', true)\n            } else {\n              this.loading = false\n              this.$message.error(`${res.message}`)\n            }\n          }\n        } else {\n          console.log('error submit!!')\n          this.$message.error('请填写正确的信息')\n        }\n      })\n    },\n    // 重置表单\n    resetForm(formName) {\n      if (this.pageType === 'edit') {\n        this.setInfo()\n      } else {\n        this.form.group_ids = []\n        this.$refs[formName].resetFields()\n      }\n    },\n    setInfo() {\n      console.log(this.info)\n      this.form.username = this.info.username\n      this.form.code = this.info.code\n      const temp = []\n      this.info.group_ids.forEach(item => {\n        temp.push(item.id)\n      })\n      this.form.group_ids = temp\n    },\n  },\n  created() {\n    // 通过是否接收到数据来判断当前页面是添加数据还是编辑数据\n    if (this.pageType === 'edit') {\n      this.setInfo()\n      this.isEdited = true\n    }\n  },\n}\n",{"version":3,"sources":["user-info.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"user-info.vue","sourceRoot":"src/view/admin/user","sourcesContent":["<template>\n  <div class=\"container\">\n    <el-form\n      :model=\"form\"\n      status-icon\n      :rules=\"rules\"\n      :label-position=\"labelPosition\"\n      ref=\"form\"\n      label-width=\"100px\"\n      @submit.native.prevent\n    >\n      <el-form-item label=\"姓名\" prop=\"username\">\n        <el-input size=\"medium\" clearable v-model=\"form.username\" :disabled=\"isEdited\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"工号\" prop=\"code\">\n        <el-input\n          size=\"medium\"\n          clearable\n          v-model=\"form.code\"\n          :disabled=\"isEdited\"\n          auto-complete=\"new-password\"\n        ></el-input>\n      </el-form-item>\n      <el-form-item v-if=\"pageType === 'add'\" label=\"密码\" prop=\"password\">\n        <el-input\n          size=\"medium\"\n          clearable\n          type=\"password\"\n          v-model=\"form.password\"\n          auto-complete=\"new-password\"\n        ></el-input>\n      </el-form-item>\n      <el-form-item v-if=\"pageType === 'add'\" label=\"确认密码\" prop=\"confirm_password\" label-position=\"top\">\n        <el-input size=\"medium\" clearable type=\"password\" v-model=\"form.confirm_password\" autocomplete=\"off\"></el-input>\n      </el-form-item>\n      <el-form-item v-if=\"pageType !== 'password'\" label=\"选择分组\">\n        <el-checkbox-group v-model=\"form.group_ids\" size=\"small\" style=\"transform: translateY(5px);\">\n          <el-checkbox v-for=\"item in groups\" :key=\"item.id\" :label=\"item.id\" border style=\"margin-left: 0\">{{\n            item.name\n          }}</el-checkbox>\n        </el-checkbox-group>\n      </el-form-item>\n      <el-form-item v-show=\"submit\" class=\"submit\">\n        <el-button type=\"primary\" :loading=\"loading\" @click=\"submitForm('form')\">保 存</el-button>\n        <el-button @click=\"resetForm('form')\">重 置</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport Admin from '@/lin/model/admin'\nimport User from '@/lin/model/user'\n\nexport default {\n  props: {\n    submit: {\n      type: Boolean, // 表单是否显示功能按钮\n      default: true,\n    },\n    id: {\n      // 用户id\n      type: Number,\n      default: undefined,\n    },\n    groups: {\n      // 所有分组\n      type: Array,\n      default: () => {},\n    },\n    labelPosition: {\n      // 表单label位置\n      type: String,\n      default: 'right',\n    },\n    info: {\n      // 用户信息\n      type: Object,\n      default: () => {},\n    },\n    pageType: {\n      type: String,\n      default: 'add', // 区分编辑页面/添加页面\n    },\n  },\n  inject: ['eventBus'],\n  data() {\n    // 验证回调函数\n    const checkUserName = (rule, value, callback) => {\n      // eslint-disable-line\n      if (!value) {\n        callback(new Error('用户名不能为空'))\n      }\n      callback()\n    }\n    const validateCode = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error('工号不能为空'))\n      }\n      callback()\n    }\n    const validatePassword = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请输入密码'))\n      } else if (value.length < 6) {\n        callback(new Error('密码长度不能少于6位数'))\n      } else {\n        if (this.form.checkPassword !== '') {\n          this.$refs.form.validateField('confirm_password')\n        }\n        callback()\n      }\n    }\n    const validatePassword2 = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请再次输入密码'))\n      } else if (value !== this.form.password) {\n        callback(new Error('两次输入密码不一致!'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      loading: false, // 加载动画\n      isEdited: false, // 能否编辑\n      form: {\n        username: '',\n        password: '',\n        confirm_password: '',\n        code: '',\n        group_ids: [],\n      },\n      // 验证规则\n      rules: {\n        username: [\n          {\n            validator: checkUserName,\n            trigger: ['blur', 'change'],\n            required: true,\n          },\n        ],\n        password: [{ validator: validatePassword, trigger: 'blur', required: true }],\n        confirm_password: [{ validator: validatePassword2, trigger: 'blur', required: true }],\n        code: [{ validator: validateCode, trigger: 'blur', required: true },\n        ],\n      },\n    }\n  },\n  methods: {\n    // 提交表单\n    async submitForm(formName) {\n      this.$refs[formName].validate(async valid => {\n        // eslint-disable-line\n        if (valid) {\n          // 新增用户\n          let res\n          if (this.pageType === 'add') {\n            try {\n              this.loading = true\n              res = await User.register(this.form)\n              if (res.code < window.MAX_SUCCESS_CODE) {\n                this.loading = false\n                this.$message.success(`${res.message}`)\n                this.eventBus.$emit('addUser', true)\n                this.resetForm(formName)\n              }\n            } catch (e) {\n              this.loading = false\n              if (e.data.code === 10073 || e.data.code === 10071) {\n                this.$message.error(e.data.message)\n              } else {\n                this.$message.error('新增用户失败')\n              }\n            }\n          } else {\n            // 更新用户信息\n            if (\n              this.form.code === this.info.code\n              && this.form.group_ids.sort().toString() === this.info.group_ids.sort().toString()\n            ) {\n              this.$emit('handleInfoResult', false)\n              return\n            }\n            try {\n              this.loading = true\n              res = await Admin.updateOneUser(this.form.code, this.form.group_ids, this.id)\n            } catch (e) {\n              this.loading = false\n              console.log(e)\n            }\n            if (res.code < window.MAX_SUCCESS_CODE) {\n              this.loading = false\n              this.$message.success(`${res.message}`)\n              this.$emit('handleInfoResult', true)\n            } else {\n              this.loading = false\n              this.$message.error(`${res.message}`)\n            }\n          }\n        } else {\n          console.log('error submit!!')\n          this.$message.error('请填写正确的信息')\n        }\n      })\n    },\n    // 重置表单\n    resetForm(formName) {\n      if (this.pageType === 'edit') {\n        this.setInfo()\n      } else {\n        this.form.group_ids = []\n        this.$refs[formName].resetFields()\n      }\n    },\n    setInfo() {\n      console.log(this.info)\n      this.form.username = this.info.username\n      this.form.code = this.info.code\n      const temp = []\n      this.info.group_ids.forEach(item => {\n        temp.push(item.id)\n      })\n      this.form.group_ids = temp\n    },\n  },\n  created() {\n    // 通过是否接收到数据来判断当前页面是添加数据还是编辑数据\n    if (this.pageType === 'edit') {\n      this.setInfo()\n      this.isEdited = true\n    }\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  margin-top: 20px;\n  margin-left: -5px;\n  max-width: 800px;\n\n  .submit {\n    float: left;\n  }\n}\n</style>\n\n<style lang=\"scss\">\n// .el-radio-group {\n//   &.user-info {\n//     display: flex;\n//     flex-wrap: wrap;\n//     > .el-radio {\n//       width: 150px;\n//       margin-left: 0px !important;\n//       margin-right: 10px;\n//       margin-bottom: 20px;\n//       white-space: normal;\n//       display: flex;\n//     }\n//   }\n// }\n</style>\n"]}]}