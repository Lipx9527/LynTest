{"remainingRequest":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/view/track/case/case-list.vue?vue&type=style&index=0&id=03a8bce1&lang=scss&scoped=true&","dependencies":[{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/view/track/case/case-list.vue","mtime":1607682215000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/sass-loader/lib/loader.js","mtime":1533139052000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.body {\n  display: flex;\n  margin-top: 5px;\n\n  .project-node-card {\n    width: 22%;\n    height: 700px;\n    margin-left: 5px;\n  }\n\n  .case-manage-card {\n    width: 78%;\n    height: 700px;\n    margin-left: 5px;\n    margin-right: 5px;\n\n    .breadcrumb {\n      font-size: 1.6em\n    }\n\n    .title_row {\n      margin-top: 10px;\n\n      .header-left {\n        float: left;\n      }\n\n      .header-right {\n        float: right;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n    }\n\n    .case-table {\n      margin-top: 10px;\n    }\n  }\n}\n",{"version":3,"sources":["case-list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgeA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"case-list.vue","sourceRoot":"src/view/track/case","sourcesContent":["<template xmlns:v-slot=\"http://www.w3.org/1999/XSL/Transform\">\n  <div class=\"body\">\n    <el-card class=\"project-node-card\">\n      <select-menu\n        :data=\"projects\"\n        :current-data=\"currentProject\"\n        @dataChange=\"changeProject\"/>\n      <node-tree\n        class=\"node-tree\"\n        @nodeSelectEvent=\"nodeChange\"\n        @refresh=\"refresh\"\n        :tree-nodes=\"treeNodes\"\n        :type=\"'edit'\"\n        :select-node.sync=\"selectNode\"\n        @refreshTable=\"refreshTable\"\n        :current-project=\"currentProject\"\n        draggable\n        ref=\"nodeTree\"/>\n    </el-card>\n    <el-card class=\"case-manage-card\">\n      <el-breadcrumb separator-class=\"el-icon-arrow-right\">\n        <el-breadcrumb-item>\n          <a><i @click=\"bachHome\" class=\"el-icon-s-home breadcrumb\"></i></a>\n        </el-breadcrumb-item>\n        <el-breadcrumb-item v-for=\"node in selectParentNodes\" :key=\"node.id\">\n          <a class=\"breadcrumb\">{{node.name}}</a>\n        </el-breadcrumb-item>\n      </el-breadcrumb>\n      <el-row class=\"title_row\">\n        <div class=\"header-left\">\n          <el-button @click=\"handleCreate\" type=\"primary\"\n                     :disabled=\"selectNodeIds.length === 0\"\n                     class=\"create-button\">创建用例</el-button>\n        </div>\n        <div class=\"header-right\">\n          <lyn-search v-model=\"search.case_name\" placeholder=\"用例名筛选\" @change=\"refreshTable\"></lyn-search>\n          <el-pagination background\n                         @size-change=\"handleSizeChange\"\n                         @current-change=\"handleCurrentChange\"\n                         :current-page=\"search.page\"\n                         :page-size=\"search.count\"\n                         :page-sizes=\"[10, 20, 50, 100]\"\n                         :total=\"total\" layout=\"total, sizes, prev, pager, next\"/>\n        </div>\n      </el-row>\n      <el-table :data=\"caseList\" stripe class=\"case-table\">\n        <el-table-column prop=\"id\" label=\"id\" width=\"60\" show-overflow-tooltip></el-table-column>\n        <el-table-column prop=\"name\" label=\"用例名称\" show-overflow-tooltip width=\"120\"></el-table-column>\n        <el-table-column prop=\"description\" label=\"描述\" show-overflow-tooltip width=\"60\">\n          <template v-slot:default=\"scope\">\n            <el-tooltip effect=\"dark\" placement=\"top-start\" v-if=\"scope.row.description\">\n              <div slot=\"content\">{{scope.row.description}}</div>\n              <l-icon name=\"read\" color=\"#409EFF\" height=\"1.6em\" width=\"1.6em\"></l-icon>\n            </el-tooltip>\n            <l-icon name=\"read\" color=\"#ccc\" height=\"1.6em\" width=\"1.6em\" v-else></l-icon>\n          </template>\n        </el-table-column>\n        <el-table-column\n          prop=\"priority\"\n          column-key=\"priority\"\n          label=\"优先级\"\n          show-overflow-tooltip\n          :filters=\"priorityList\"\n          :filter-method=\"priorityFilter\"\n          filter-placement=\"bottom-end\"\n          width=\"120\">\n          <template v-slot:default=\"scope\">\n            <span>\n              <el-tag :type=\"getPriorityStyle(scope.row.priority)\" effect=\"dark\">{{ scope.row.priority }}</el-tag>\n            </span>\n          </template>\n        </el-table-column>\n        <el-table-column\n          prop=\"type\"\n          label=\"类型\"\n          show-overflow-tooltip\n          width=\"120\">\n        </el-table-column>\n\n        <el-table-column\n          prop=\"review_status\"\n          label=\"评审状态\"\n          :filters=\"reviewStatusList\"\n          :filter-method=\"reviewStatusFilter\"\n          filter-placement=\"bottom-end\"\n          width=\"120\">\n          <template v-slot:default=\"scope\">\n            <span>\n              <el-tag v-if=\"scope.row.review_status === 'Prepare'\" type=\"info\">未评审</el-tag>\n              <el-tag v-if=\"scope.row.review_status === 'Pass'\" type=\"success\">通过</el-tag>\n              <el-tag v-if=\"scope.row.review_status === 'UnPass'\" type=\"danger\">未通过</el-tag>\n            </span>\n          </template>\n        </el-table-column>\n\n        <el-table-column\n          prop=\"update_time\"\n          label=\"更新时间\"\n          show-overflow-tooltip>\n        </el-table-column>\n        <el-table-column fixed=\"right\" width=\"160\" label=\"操作\">\n          <template v-slot:default=\"scope\">\n            <el-tooltip content=\"编辑\"\n                        placement=\"bottom\"\n                        :enterable=\"false\"\n                        effect=\"dark\">\n              <el-button\n                size=\"small\"\n                type=\"primary\"\n                icon=\"el-icon-edit\"\n                circle\n                @click=\"handleEdit(scope.row)\"></el-button>\n            </el-tooltip>\n            <el-tooltip content=\"复制\"\n                        placement=\"bottom\"\n                        :enterable=\"false\"\n                        effect=\"dark\">\n              <el-button\n                size=\"small\"\n                type=\"warning\"\n                icon=\"el-icon-document-copy\"\n                circle\n                @click=\"handleCopy(scope.row)\"></el-button>\n            </el-tooltip>\n            <el-tooltip content=\"删除\"\n                        placement=\"bottom\"\n                        :enterable=\"false\"\n                        effect=\"dark\">\n              <el-button\n                size=\"small\"\n                type=\"danger\"\n                icon=\"el-icon-delete\"\n                circle\n                @click=\"handleDelete(scope.row.id)\"></el-button>\n            </el-tooltip>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-card>\n\n    <el-dialog :close-on-click-modal=\"false\"\n               :title=\"operationType === 1 ? '创建用例' : '用例编辑'\"\n               :visible.sync=\"editDialogVisible\" width=\"65%\">\n      <el-form :model=\"caseInfo\"  ref=\"caseInfo\" label-width=\"80px\">\n        <!--用例基础信息-->\n        <el-row>\n          <el-col :span=\"17\" :offset=\"1\">\n            <el-form-item\n              label=\"用例名称\"\n              prop=\"name\">\n              <el-input class=\"case-name\" placeholder=\"请输入用例名称\" v-model=\"caseInfo.name\"></el-input>\n            </el-form-item>\n          </el-col>\n        </el-row>\n\n        <el-row>\n          <el-col :span=\"10\" :offset=\"1\">\n            <el-form-item label=\"用例类型\"  prop=\"type\">\n              <el-select v-model=\"caseInfo.type\" clearable>\n                <el-option v-for=\"item in typeList\" :label=\"item\" :value=\"item\" :key=\"item.index\"/>\n              </el-select>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"用例等级\"  prop=\"priority\">\n              <el-select v-model=\"caseInfo.priority\" clearable>\n                <el-option v-for=\"item in priorityList\" :label=\"item.test\" :value=\"item.value\" :key=\"item.index\"/>\n              </el-select>\n            </el-form-item>\n          </el-col>\n        </el-row>\n\n        <!--测试步骤-->\n        <el-row style=\"margin-bottom: 10px\">\n          <el-col :offset=\"1\">\n            <div class=\"el-form-item__label\">操作步骤:</div>\n          </el-col>\n        </el-row>\n        <el-row type=\"flex\">\n          <el-col :span=\"22\" :offset=\"1\">\n            <el-table\n              :data=\"caseInfo.steps\"\n              class=\"tb-edit\"\n              border\n              size=\"mini\"\n              highlight-current-row>\n              <el-table-column label=\"编码\" prop=\"num\" min-width=\"10%\"></el-table-column>\n              <el-table-column label=\"步骤描述\" prop=\"description\" min-width=\"35%\">\n                <template v-slot:default=\"scope\">\n                  <el-input\n                    class=\"table-edit-input\"\n                    size=\"mini\"\n                    type=\"textarea\"\n                    :autosize=\"{ minRows: 1, maxRows: 6}\"\n                    :rows=\"2\"\n                    v-model=\"scope.row.desc\"\n                    placeholder=\"请输入内容\"\n                    clearable/>\n                </template>\n              </el-table-column>\n              <el-table-column label=\"预期结果\" prop=\"result\" min-width=\"35%\">\n                <template v-slot:default=\"scope\">\n                  <el-input\n                    class=\"table-edit-input\"\n                    size=\"mini\"\n                    type=\"textarea\"\n                    :autosize=\"{ minRows: 1, maxRows: 6}\"\n                    :rows=\"2\"\n                    v-model=\"scope.row.result\"\n                    placeholder=\"请输入内容\"\n                    clearable/>\n                </template>\n              </el-table-column>\n              <el-table-column label=\"操作\" min-width=\"20%\">\n                <template v-slot:default=\"scope\">\n                  <el-button\n                    type=\"primary\"\n                    icon=\"el-icon-plus\"\n                    circle size=\"mini\"\n                    @click=\"handleAddStep(scope.$index, scope.row)\"></el-button>\n                  <el-button\n                    icon=\"el-icon-document-copy\"\n                    type=\"success\"\n                    circle size=\"mini\"\n                    @click=\"handleCopyStep(scope.$index, scope.row)\"></el-button>\n                  <el-button\n                    type=\"danger\"\n                    icon=\"el-icon-delete\"\n                    circle size=\"mini\"\n                    @click=\"handleDeleteStep(scope.$index, scope.row)\"\n                    :disabled=\"scope.$index === 0 && caseInfo.steps.length <= 1\"></el-button>\n                </template>\n              </el-table-column>\n            </el-table>\n          </el-col>\n        </el-row>\n\n        <!--备注-->\n        <el-row style=\"margin-top: 15px;margin-bottom: 10px\">\n          <el-col :offset=\"1\">\n            <div class=\"el-form-item__label\">备注:</div>\n          </el-col>\n        </el-row>\n        <el-row type=\"flex\">\n          <el-col :span=\"22\" :offset=\"1\">\n            <el-form-item prop=\"description\" label-width=\"0\">\n              <el-input v-model=\"caseInfo.description\"\n                        :autosize=\"{ minRows: 3, maxRows: 5}\"\n                        type=\"textarea\"\n                        :rows=\"3\"\n                        placeholder=\"请输入内容\"></el-input>\n            </el-form-item>\n          </el-col>\n        </el-row>\n      </el-form>\n\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"editDialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"saveCase\">保 存</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport LynSearch from '@/component/lyn/lyn-search'\nimport SelectMenu from '@/component/common/select-menu'\nimport NodeTree from '@/component/common/node-tree'\nimport Project from '@/model/track/project'\nimport Node from '@/model/track/node'\nimport TestCase from '@/model/track/case'\n\nexport default {\n  name: 'case-list',\n  components: {\n    SelectMenu,\n    NodeTree,\n    LynSearch\n  },\n  data() {\n    return {\n      search: {\n        case_name: '',\n        count: 10,\n        page: 1,\n      },\n      total: 0,\n      result: {},\n      projects: [],\n      currentProject: null,\n      treeNodes: [],\n      selectNodeIds: [],\n      selectParentNodes: [],\n      selectNode: {},\n      caseList: [],\n      operationType: null,\n      editDialogVisible: false,\n      caseInfo: {},\n      defaultCaseInfo: {\n        name: '',\n        type: '',\n        priority: '',\n        steps: [{ num: 1, result: '', steps: '', description: '' }]\n      },\n      typeList: ['功能测试', '性能测试', '接口测试', '冒烟测试', '回归测试', '其它'],\n      priorityList: [{ text: 'P1', value: 'P1' },\n        { text: 'P2', value: 'P2' },\n        { text: 'P3', value: 'P3' },\n        { text: 'P4', value: 'P4' }],\n      reviewStatusList: [{ text: '未评审', value: 'Prepare' },\n        { text: '通过', value: 'Pass' },\n        { text: '未通过', value: 'UnPass' }],\n    }\n  },\n  mounted() {\n    this.pageInit()\n  },\n  methods: {\n    async pageInit() {\n      await this.getProjects()\n      await this.getNodeTree()\n      await this.refreshTable()\n    },\n    async getProjects() {\n      const res = await Project.getNewProject(20)\n      this.projects = res.items\n      this.setCurrentProject(res.items[0])\n    },\n    async getNodeTree() {\n      this.treeNodes = await Node.getNodeByProjectId(this.currentProject.id)\n    },\n    changeProject(project) {\n      this.setCurrentProject(project)\n      this.refreshTable()\n    },\n    nodeChange(nodeIds, pNodes) {\n      this.selectNodeIds = nodeIds\n      this.selectParentNodes = pNodes\n      this.refreshTable()\n    },\n    bachHome() {\n      this.selectNodeIds = []\n      this.selectParentNodes = []\n      this.selectNode = {}\n      this.refreshTable()\n    },\n    handleCreate() {\n      this.editDialogVisible = true\n      this.caseInfo = { ...this.defaultCaseInfo }\n      this.operationType = 1\n    },\n    handleEdit(row) {\n      this.editDialogVisible = true\n      this.caseInfo = { ...row }\n      this.operationType = 2\n    },\n    handleCopy(row) {\n      this.editDialogVisible = true\n      this.caseInfo = { ...row }\n      this.operationType = 1\n    },\n    handleDelete(id) {\n      this.$confirm('确定要删除吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n      })\n        .then(\n          async () => {\n            const res = await TestCase.deleteCase(id)\n            if (res.code < window.MAX_SUCCESS_CODE) {\n              this.$message.success(res.message)\n              this.refreshTable()\n            } else {\n              this.$message.error('删除功能异常')\n            }\n          }\n        )\n    },\n    handleSizeChange(val) {\n      this.search.count = val\n      this.refreshTable()\n    },\n    handleCurrentChange(val) {\n      this.search.page = val\n      this.refreshTable()\n    },\n    priorityFilter(value, row) {\n      return row.priority === value\n    },\n    getPriorityStyle(val) {\n      if (val === 'P1' || val === 'P2') {\n        return 'danger'\n      }\n      if (val === 'P3') {\n        return 'warning'\n      }\n      if (val === 'P4') {\n        return 'success'\n      }\n    },\n    reviewStatusFilter(value, row) {\n      return row.review_status === value\n    },\n    async refreshTable() {\n      this.search.node_ids = this.selectNodeIds\n      this.search.project_id = this.currentProject.id\n      const res = await TestCase.getCaseList(this.search)\n      res.items.forEach(e => {\n        e.steps = JSON.parse(e.steps)\n      })\n      this.caseList = res.items\n      this.total = res.total\n    },\n    setCurrentProject(project) {\n      if (project) {\n        this.currentProject = project\n      }\n      this.refresh()\n    },\n    refresh() {\n      this.selectNodeIds = []\n      this.selectParentNodes = []\n      this.selectNode = {}\n      this.getNodeTree()\n    },\n    handleAddStep(index, data) {\n      const step = {}\n      step.num = data.num + 1\n      step.desc = ''\n      step.result = ''\n      this.caseInfo.steps.forEach(s => {\n        if (s.num > data.num) {\n          s.num++\n        }\n      })\n      this.caseInfo.steps.splice(index + 1, 0, step)\n    },\n    handleCopyStep(index, data) {\n      const step = {}\n      step.num = data.num + 1\n      step.desc = data.desc\n      step.result = data.result\n      this.caseInfo.steps.forEach(s => {\n        if (s.num > data.num) {\n          s.num++\n        }\n      })\n      this.caseInfo.steps.splice(index + 1, 0, step)\n    },\n    handleDeleteStep(index, data) {\n      this.caseInfo.steps.splice(index, 1)\n      this.caseInfo.steps.forEach(step => {\n        if (step.num > data.num) {\n          step.num--\n        }\n      })\n    },\n    async saveCase() {\n      const param = { ...this.caseInfo }\n      const nodeId = this.selectNodeIds[0]\n      param.steps = JSON.stringify(this.caseInfo.steps)\n      if (!param.node_id) {\n        param.node_id = nodeId\n      }\n      param.project_id = this.currentProject.id\n      const res = this.operationType === 1 ? await TestCase.createCase(param) : await TestCase.updateCase(param)\n      if (res.code < window.MAX_SUCCESS_CODE) {\n        this.$message.success(res.message)\n        this.editDialogVisible = false\n        this.refreshTable()\n      } else {\n        this.$message.error('服务端异常')\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.body {\n  display: flex;\n  margin-top: 5px;\n\n  .project-node-card {\n    width: 22%;\n    height: 700px;\n    margin-left: 5px;\n  }\n\n  .case-manage-card {\n    width: 78%;\n    height: 700px;\n    margin-left: 5px;\n    margin-right: 5px;\n\n    .breadcrumb {\n      font-size: 1.6em\n    }\n\n    .title_row {\n      margin-top: 10px;\n\n      .header-left {\n        float: left;\n      }\n\n      .header-right {\n        float: right;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n    }\n\n    .case-table {\n      margin-top: 10px;\n    }\n  }\n}\n</style>\n"]}]}