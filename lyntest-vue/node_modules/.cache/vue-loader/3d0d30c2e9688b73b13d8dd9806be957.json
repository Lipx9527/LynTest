{"remainingRequest":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/component/statistical/function/data-manage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/component/statistical/function/data-manage.vue","mtime":1606834545502},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Manager from '@/model/statistical/manager'\nimport Function from '@/model/statistical/function'\n\nexport default {\n  data() {\n    return {\n      date: [],\n      tester_list: {},\n      dev_list: [],\n      product_line_list: [],\n      total: 0,\n      search: {\n        start_date: '',\n        end_date: '',\n        tester_code: '',\n        dev_code: '',\n        product_code: '',\n        count: 10,\n        page: 1,\n      },\n      upload_dialog_visible: false,\n      file_list: [],\n      tableData: [],\n      edit_dialog_visible: false,\n      function_info: {},\n    }\n  },\n  mounted() {\n    this.getDevList()\n    this.getTesterList()\n    this.getProductLineList()\n    this.searchFunctionList()\n  },\n  methods: {\n    async chooseDate(date) {\n      this.search.page = 1\n      if (date === null) {\n        this.search.start_date = ''\n        this.search.end_date = ''\n      } else {\n        [this.search.start_date, this.search.end_date] = date\n      }\n      await this.searchFunctionList()\n    },\n    async getTesterList() {\n      this.tester_list = await Manager.getTesterList()\n    },\n    async getDevList() {\n      this.dev_list = await Manager.getDevList()\n    },\n    // 获取产品线列表\n    async getProductLineList() {\n      this.product_line_list = await Manager.getProductList()\n    },\n    async searchFunctionList() {\n      const res = await Function.searchFuncList(this.search)\n      this.tableData = res.items\n      this.total = res.total\n    },\n    exportExcel() {\n      this.$axios({\n        method: 'post',\n        url: '/statistical/func/download',\n        responseType: 'blob',\n        data: this.search\n      }).then(\n        res => {\n          const link = document.createElement('a')\n          link.style.display = 'none'\n          link.href = URL.createObjectURL(new Blob([res]))\n          link.setAttribute('download', '功能点信息.xlsx')\n          document.body.appendChild(link)\n          link.click()\n          URL.revokeObjectURL(link.href)\n          document.body.removeChild(link)\n        }\n      )\n    },\n    handleSizeChange(val) {\n      this.search.count = val\n      this.searchFunctionList()\n    },\n    handleCurrentChange(val) {\n      this.search.page = val\n      this.searchFunctionList()\n    },\n    editFunction(row) {\n      this.edit_dialog_visible = true\n      this.function_info = { ...row }\n    },\n    async modifyFunction() {\n      const res = await Function.updateFunc(this.function_info)\n      if (res.code < window.MAX_SUCCESS_CODE) {\n        this.$message.success(`${res.message}`)\n        this.edit_dialog_visible = false\n        this.searchFunctionList()\n      } else {\n        this.$message.error('修改功能点功能异常')\n      }\n    },\n    async deleteFunction(id) {\n      const res = await Function.deleteFunc(id)\n      if (res.code < window.MAX_SUCCESS_CODE) {\n        this.$message.success(`${res.message}`)\n        this.searchFunctionList()\n      } else {\n        this.$message.error('删除功能点功能异常')\n      }\n    },\n    // 文件超出个数限制时的钩子\n    exceedFile(files, fileList) {\n      this.$message.warning(`只能选择 1 个文件，当前共选择了 ${files.length + fileList.length} 个`)\n    },\n    // 文件状态改变时的钩子\n    fileChange(file) {\n      this.file_list.push(file.raw)\n    },\n    // 上传文件之前的钩子, 参数为上传的文件,若返回 false 或者返回 Promise 且被 reject，则停止上传\n    beforeUploadFile(file) {\n      const extension = file.name.substring(file.name.lastIndexOf('.') + 1)\n      const size = file.size / 1024 / 1024\n      if (extension !== 'xlsx') {\n        this.$message.warning('只能上传后缀是.xlsx的文件')\n      }\n      if (size > 10) {\n        this.$message.warning('文件大小不得超过10M')\n      }\n    },\n    deleteFile(file) {\n      this.file_list.pop(file)\n    },\n    uploadFile() {\n      if (this.file_list.length === 0) {\n        this.$message.warning('请上传文件')\n      } else {\n        const form = new FormData()\n        form.append('file', this.file_list[0])\n        this.$axios({\n          method: 'post',\n          url: '/statistical/func/upload',\n          headers: {\n            'Content-type': 'multipart/form-data'\n          },\n          data: form\n        }).then(\n          res => {\n            if (res.success === true) {\n              this.file_list = []\n              this.$message.success(res.result)\n              this.upload_dialog_visible = false\n              this.searchFunctionList()\n            } else if (res.success === false) {\n              this.$message.error(res.msg)\n            }\n          }\n        )\n      }\n    }\n  }\n}\n",null]}