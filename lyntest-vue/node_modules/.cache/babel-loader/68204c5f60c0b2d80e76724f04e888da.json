{"remainingRequest":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/babel-loader/lib/index.js!/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyn/Desktop/lyntest/lyntest-vue/src/view/autotest/report-detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/src/view/autotest/report-detail.vue","mtime":1608796653787},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/@babel/runtime/regenerator\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport CollectionReport from '@/model/autotest/collection-report';\nimport AssertionsDetail from '@/component/autotest/assertions-detail';\nimport VariableDetail from '@/component/autotest/variable-detail';\nimport ReadOnlyContent from '@/component/autotest/read-only-content';\nimport ResponseStatus from '@/component/autotest/response-status';\nexport default {\n  components: {\n    AssertionsDetail: AssertionsDetail,\n    ReadOnlyContent: ReadOnlyContent,\n    ResponseStatus: ResponseStatus,\n    VariableDetail: VariableDetail\n  },\n  data: function data() {\n    return {\n      report_id: null,\n      collection_id: null,\n      report_loading: true,\n      total_count: 0,\n      percentage: 0,\n      sort_switch: false,\n      base_result_list: [],\n      result_list: [],\n      case_detail: {},\n      case_choose: false,\n      chartSettings: {\n        radius: [65, 45],\n        hoverAnimation: false,\n        label: {\n          show: false\n        }\n      },\n      chartExtend: {\n        graphic: [{\n          type: 'text',\n          left: 'center',\n          top: '45%',\n          style: {\n            text: 0,\n            textAlign: 'center',\n            fill: '#000',\n            fontSize: 28\n          }\n        }, {\n          type: 'text',\n          left: 'center',\n          top: '55%',\n          style: {\n            text: '请求',\n            textAlign: 'center',\n            fill: '#999999',\n            fontSize: 16\n          }\n        }],\n        color: ['#00C292', '#E46A76']\n      },\n      chartData: {\n        columns: ['type', 'count'],\n        rows: [{\n          type: '成功',\n          count: 0\n        }, {\n          type: '失败',\n          count: 0\n        }]\n      },\n      result_css: {\n        status_code_type: 'success',\n        time_type: 'success'\n      }\n    };\n  },\n  watch: {\n    total_count: function total_count(val) {\n      this.chartExtend.graphic[0].style.text = val;\n    },\n    $route: function $route() {\n      this.pageInit();\n    }\n  },\n  mounted: function mounted() {\n    this.pageInit();\n  },\n  destroyed: function destroyed() {\n    if (this.websocket) {\n      this.websocket.close();\n    }\n  },\n  methods: {\n    pageInit: function () {\n      var _pageInit = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var _this$report_id$split, _this$report_id$split2, collection_id;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.report_id = this.$route.params.id;\n                _this$report_id$split = this.report_id.split('_'), _this$report_id$split2 = _slicedToArray(_this$report_id$split, 1), collection_id = _this$report_id$split2[0];\n                this.collection_id = collection_id;\n                _context.next = 5;\n                return this.getReportDetail();\n\n              case 5:\n                if (_context.sent) {\n                  _context.next = 7;\n                  break;\n                }\n\n                this.initWebSocket();\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function pageInit() {\n        return _pageInit.apply(this, arguments);\n      }\n\n      return pageInit;\n    }(),\n    getReportDetail: function () {\n      var _getReportDetail = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return CollectionReport.getReportDetail(this.report_id);\n\n              case 2:\n                res = _context2.sent;\n\n                if (res) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", false);\n\n              case 5:\n                this.report_loading = false;\n                this.dataInit(res);\n                return _context2.abrupt(\"return\", true);\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getReportDetail() {\n        return _getReportDetail.apply(this, arguments);\n      }\n\n      return getReportDetail;\n    }(),\n    dataInit: function dataInit(res) {\n      var pass_count = res.pass_count,\n          error_count = res.error_count,\n          result = res.result;\n      this.total_count = pass_count + error_count;\n      this.chartData.rows[0].count = pass_count;\n      this.chartData.rows[1].count = error_count;\n      this.base_result_list = result.slice();\n      this.result_list = result.slice();\n      this.dataSort();\n    },\n    dataSort: function dataSort() {\n      if (this.sort_switch) {\n        this.result_list = this.base_result_list.slice();\n      } else {\n        this.result_list.sort(function (a, b) {\n          return a.expected_is_pass - b.expected_is_pass;\n        });\n      }\n    },\n    initWebSocket: function initWebSocket() {\n      var uri = process.env.VUE_APP_SOCKET_URL;\n      console.log(uri);\n      this.websocket = new WebSocket(uri);\n      this.websocket.onmessage = this.websocketOnMessage;\n      this.websocket.onopen = this.websocketOnOpen;\n      this.websocket.onerror = this.websocketOnError;\n      this.websocket.onclose = this.websocketClose;\n    },\n    websocketOnOpen: function websocketOnOpen() {\n      console.log('建立连接');\n    },\n    websocketOnError: function websocketOnError() {\n      // 连接建立失败重连\n      this.initWebSocket();\n    },\n    websocketOnMessage: function () {\n      var _websocketOnMessage = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(e) {\n        var _e$data$split, _e$data$split2, type, collection_id, percentage;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _e$data$split = e.data.split('_'), _e$data$split2 = _slicedToArray(_e$data$split, 3), type = _e$data$split2[0], collection_id = _e$data$split2[1], percentage = _e$data$split2[2];\n\n                if (!(type !== 'collection')) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 3:\n                if (!(collection_id !== this.collection_id)) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 5:\n                this.percentage = Number(percentage);\n\n                if (!(Number(percentage) === 100)) {\n                  _context3.next = 12;\n                  break;\n                }\n\n                this.websocket.close();\n                _context3.next = 10;\n                return new Promise(function (resolve) {\n                  setTimeout(function () {\n                    return resolve('done!');\n                  }, 1000);\n                });\n\n              case 10:\n                _context3.next = 12;\n                return this.getReportDetail();\n\n              case 12:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function websocketOnMessage(_x) {\n        return _websocketOnMessage.apply(this, arguments);\n      }\n\n      return websocketOnMessage;\n    }(),\n    websocketSend: function websocketSend(data) {\n      // 数据发送\n      this.websocket.send(data);\n    },\n    websocketClose: function websocketClose(e) {\n      // 关闭\n      console.log('断开连接', e);\n    },\n    getCaseDetail: function getCaseDetail(caseInfo) {\n      this.case_choose = true;\n      this.result_list.forEach(function (e) {\n        e.is_choose = false;\n      });\n      caseInfo.is_choose = true;\n      this.case_detail = caseInfo;\n    }\n  }\n};",{"version":3,"sources":["report-detail.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div v-if=\"report_loading\" class=\"loading-container\">\n    <el-progress class=\"progress\" type=\"circle\" :percentage=\"percentage\" :width=\"160\" :stroke-width=\"16\"></el-progress>\n  </div>\n  <div v-else class=\"container\" >\n    <div class=\"case-info\">\n      <el-card class=\"ring-card\">\n        <ve-ring :data=\"chartData\"\n                 :settings=\"chartSettings\"\n                 :extend=\"chartExtend\" class=\"ring\">\n        </ve-ring>\n      </el-card>\n      <el-card class=\"case-list\">\n        <el-switch class=\"sort-switch\" v-model=\"sort_switch\" active-color=\"#13ce66\" inactive-color=\"#ff4949\" @change=\"dataSort\"></el-switch>\n        <div style=\"height: 360px\">\n          <vue-scroll>\n            <div v-for=\"item in result_list\"\n                 :class=\"{'case-title-normal': !item.is_choose, 'case-title-choose':item.is_choose}\"\n                 :key=\"item.index\"\n                 @click=\"getCaseDetail(item)\">\n              <i class=\"el-icon-success icon\" v-if=\"item.expected_is_pass\" style=\"color: #00C292\"></i>\n              <i class=\"el-icon-error icon\" v-else-if=\"!item.expected_is_pass\" style=\"color: #E46A76\"></i>\n              <span class=\"title\">\n              {{item.case_name}}\n              </span>\n            </div>\n          </vue-scroll>\n        </div>\n      </el-card>\n    </div>\n    <el-card class=\"case-detail\">\n      <div v-show=\"case_choose\" style=\"height: 660px\">\n        <vue-scroll>\n          <div class=\"header\">\n            <div class=\"title\">\n              {{case_detail.case_name}}\n            </div>\n            <response-status v-if=\"case_detail.status_code\"\n                             :status-code=\"case_detail.status_code\"\n                             :message=\"case_detail.message\"\n                             :response-time=\"case_detail.response_time\"/>\n          </div>\n          <assertions-detail :result=\"case_detail.expected_res\"\n                             class=\"table\"\n                             v-if=\"case_choose && case_detail.expected_res.length !== 0\">\n          </assertions-detail>\n          <variable-detail :result=\"case_detail.variable_list\"\n                           class=\"table\"\n                           v-if=\"case_choose && case_detail.variable_list.length !== 0\">\n          </variable-detail>\n          <read-only-content title=\"URL\" :content=\"case_detail.url\"></read-only-content>\n          <read-only-content title=\"Request\" :content=\"case_detail.request_text\"></read-only-content>\n          <read-only-content title=\"Response\" :content=\"case_detail.response_text\"></read-only-content>\n        </vue-scroll>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport CollectionReport from '@/model/autotest/collection-report'\nimport AssertionsDetail from '@/component/autotest/assertions-detail'\nimport VariableDetail from '@/component/autotest/variable-detail'\nimport ReadOnlyContent from '@/component/autotest/read-only-content'\nimport ResponseStatus from '@/component/autotest/response-status'\n\nexport default {\n  components: {\n    AssertionsDetail,\n    ReadOnlyContent,\n    ResponseStatus,\n    VariableDetail,\n  },\n  data() {\n    return {\n      report_id: null,\n      collection_id: null,\n      report_loading: true,\n      total_count: 0,\n      percentage: 0,\n      sort_switch: false,\n      base_result_list: [],\n      result_list: [],\n      case_detail: {},\n      case_choose: false,\n      chartSettings: {\n        radius: [65, 45],\n        hoverAnimation: false,\n        label: { show: false }\n      },\n      chartExtend: {\n        graphic: [{\n          type: 'text',\n          left: 'center',\n          top: '45%',\n          style: {\n            text: 0,\n            textAlign: 'center',\n            fill: '#000',\n            fontSize: 28,\n          }\n        }, {\n          type: 'text',\n          left: 'center',\n          top: '55%',\n          style: {\n            text: '请求',\n            textAlign: 'center',\n            fill: '#999999',\n            fontSize: 16,\n          }\n        }],\n        color: ['#00C292', '#E46A76']\n      },\n      chartData: {\n        columns: ['type', 'count'],\n        rows: [\n          { type: '成功', count: 0 },\n          { type: '失败', count: 0 }\n        ]\n      },\n      result_css: {\n        status_code_type: 'success',\n        time_type: 'success',\n      },\n    }\n  },\n  watch: {\n    total_count(val) {\n      this.chartExtend.graphic[0].style.text = val\n    },\n    $route() {\n      this.pageInit()\n    }\n  },\n  mounted() {\n    this.pageInit()\n  },\n  destroyed() {\n    if (this.websocket) {\n      this.websocket.close()\n    }\n  },\n  methods: {\n    async pageInit() {\n      this.report_id = this.$route.params.id\n      const [collection_id] = this.report_id.split('_')\n      this.collection_id = collection_id\n      if (!await this.getReportDetail()) {\n        this.initWebSocket()\n      }\n    },\n    async getReportDetail() {\n      const res = await CollectionReport.getReportDetail(this.report_id)\n      if (!res) {\n        return false\n      }\n      this.report_loading = false\n      this.dataInit(res)\n      return true\n    },\n    dataInit(res) {\n      const { pass_count, error_count, result } = res\n      this.total_count = pass_count + error_count\n      this.chartData.rows[0].count = pass_count\n      this.chartData.rows[1].count = error_count\n      this.base_result_list = result.slice()\n      this.result_list = result.slice()\n      this.dataSort()\n    },\n    dataSort() {\n      if (this.sort_switch) {\n        this.result_list = this.base_result_list.slice()\n      } else {\n        this.result_list.sort((a, b) => a.expected_is_pass - b.expected_is_pass)\n      }\n    },\n    initWebSocket() {\n      const uri = process.env.VUE_APP_SOCKET_URL\n      console.log(uri)\n      this.websocket = new WebSocket(uri)\n      this.websocket.onmessage = this.websocketOnMessage\n      this.websocket.onopen = this.websocketOnOpen\n      this.websocket.onerror = this.websocketOnError\n      this.websocket.onclose = this.websocketClose\n    },\n    websocketOnOpen() {\n      console.log('建立连接')\n    },\n    websocketOnError() { // 连接建立失败重连\n      this.initWebSocket()\n    },\n    async websocketOnMessage(e) {\n      const [type, collection_id, percentage] = e.data.split('_')\n      if (type !== 'collection') {\n        return\n      }\n      if (collection_id !== this.collection_id) {\n        return\n      }\n      this.percentage = Number(percentage)\n      if (Number(percentage) === 100) {\n        this.websocket.close()\n        await new Promise(resolve => {\n          setTimeout(() => resolve('done!'), 1000)\n        })\n        await this.getReportDetail()\n      }\n    },\n    websocketSend(data) { // 数据发送\n      this.websocket.send(data)\n    },\n    websocketClose(e) { // 关闭\n      console.log('断开连接', e)\n    },\n    getCaseDetail(caseInfo) {\n      this.case_choose = true\n      this.result_list.forEach(e => {\n        e.is_choose = false\n      })\n      caseInfo.is_choose = true\n      this.case_detail = caseInfo\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n\n  .loading-container {\n    width: 100%;\n    height: 600px;\n\n    .progress {\n      top: 40%;\n      left: 50%;\n      transform: translate(-50%,-50%);\n    }\n  }\n\n  .container {\n    display: flex;\n    padding: 10px 10px;\n\n    .case-info {\n      display: flex;\n      flex-direction: column;\n      width: 40%;\n\n      .ring-card {\n        height: 240px;\n\n        .ring {\n          transform: translateY(-90px);\n        }\n      }\n\n      .case-list {\n        margin-top: 10px;\n        height: 440px;\n\n        .sort-switch {\n          padding-bottom: 10px;\n        }\n\n        .case-title {\n          height: 30px;\n          width: 98%;\n          border:1px solid #b3d8ff;\n          margin-bottom: 6px;\n          display: flex;\n          align-items: center;\n\n          .icon {\n            margin-left: 10px;\n          }\n\n          .title {\n            margin-left: 10px;\n          }\n        }\n\n        .case-title-normal {\n          @extend .case-title;\n          color: #409EFF;\n          background: #ecf5ff;\n        }\n\n        .case-title-normal:hover {\n          border: 1px solid #409EFF;\n        }\n\n        .case-title-choose{\n          @extend .case-title;\n          color: #ecf5ff;\n          background: #409EFF;\n        }\n      }\n    }\n\n    .case-detail {\n      margin-left: 10px;\n      width: 60%;\n      height: 690px;\n\n      .header {\n        display: flex;\n        align-items: flex-end;\n        justify-content: space-between;\n\n        .title {\n          color: $parent-title-color;\n          font-size: 20px;\n          font-weight: 500;\n        }\n      }\n\n      .table {\n        margin-top: 10px;\n      }\n\n      .response-text {\n        margin-top: 10px;\n        word-wrap: break-word;\n        word-break: normal;\n      }\n\n    }\n\n  }\n</style>\n"],"sourceRoot":"src/view/autotest"}]}