{"remainingRequest":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/thread-loader/dist/cjs.js!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/lin/util/sse.js","dependencies":[{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/lin/util/sse.js","mtime":1606834545464},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Vue from 'vue'; // import EventSourcePolyfill from 'event-source-polyfill'\n\nimport 'event-source-polyfill/src/eventsource';\nimport { getToken } from './cookie';\nimport store from '../../store';\n\nvar Sse =\n/*#__PURE__*/\nfunction () {\n  /**\n   * 需在vuex中确认有user对象后才能初始化，否则不连接服务器\n   * 注意： sse单独走自己的请求路线，不与axios重合，所以axios里面的配置在此处失效\n   * @param {string} url sse全路径\n   * @param {Array} events 当前用户可监听的路径\n   */\n  function Sse(url, events) {\n    var _this = this;\n\n    _classCallCheck(this, Sse);\n\n    _defineProperty(this, \"source\", null);\n\n    /* eslint-disable no-undef */\n    this.source = new EventSourcePolyfill(url, {\n      headers: {\n        Authorization: getToken('access_token')\n      }\n    });\n    this.open();\n    events.forEach(function (event) {\n      _this.addEventListener(event);\n    });\n  }\n\n  _createClass(Sse, [{\n    key: \"open\",\n    value: function open() {\n      this.source.onopen = function (event) {\n        console.log('sse opened', event);\n      };\n    }\n  }, {\n    key: \"error\",\n    value: function error() {\n      this.source.onerror = function (event) {\n        console.log('error', event);\n      };\n    }\n  }, {\n    key: \"addEventListener\",\n    value: function addEventListener(eventName) {\n      this.source.addEventListener(eventName, function (event) {\n        // console.log('receive one message: ', event.data)\n        // console.log('receive one message: ', event.lastEventId)\n        store.commit('ADD_UNREAD_MESSAGE', {\n          data: event.data,\n          id: event.lastEventId\n        });\n        Vue.prototype.$notify({\n          title: '您有新的消息',\n          dangerouslyUseHTMLString: true,\n          message: \"<strong class=\\\"my-notify\\\">\".concat(JSON.parse(event.data).message, \"</strong>\")\n        });\n      });\n    }\n  }]);\n\n  return Sse;\n}();\n\nexport { Sse as default };",null]}