{"remainingRequest":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/thread-loader/dist/cjs.js!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/view/api-test/pressure-test.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/view/api-test/pressure-test.vue","mtime":1608716943629},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/@babel/runtime/regenerator\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Pressure from '@/model/autotest/pressure';\nimport HttpCaseChoose from '@/component/autotest/http-case-choose.vue';\nimport AssertionsDetail from '@/component/autotest/assertions-detail';\nimport VariableDetail from '@/component/autotest/variable-detail';\nimport ReadOnlyContent from '@/component/autotest/read-only-content';\nimport ResponseStatus from '@/component/autotest/response-status';\nexport default {\n  name: 'batch-execute',\n  components: {\n    HttpCaseChoose: HttpCaseChoose,\n    AssertionsDetail: AssertionsDetail,\n    VariableDetail: VariableDetail,\n    ReadOnlyContent: ReadOnlyContent,\n    ResponseStatus: ResponseStatus\n  },\n  data: function data() {\n    return {\n      websocket: null,\n      loading: false,\n      total_count: 0,\n      case_info: {},\n      dialog_visible: false,\n      param: {\n        threads: 1,\n        times: 1,\n        case_id: null\n      },\n      report_id: null,\n      report_list: [],\n      result_list: [],\n      table_data: [],\n      case_choose: false,\n      case_detail: {},\n      chartSettings: {\n        radius: [65, 45],\n        hoverAnimation: false,\n        label: {\n          show: false\n        }\n      },\n      chartExtend: {\n        graphic: [{\n          type: 'text',\n          left: 'center',\n          top: '45%',\n          style: {\n            text: 0,\n            textAlign: 'center',\n            fill: '#000',\n            fontSize: 28\n          }\n        }, {\n          type: 'text',\n          left: 'center',\n          top: '55%',\n          style: {\n            text: '请求',\n            textAlign: 'center',\n            fill: '#999999',\n            fontSize: 16\n          }\n        }],\n        color: ['#00C292', '#E46A76']\n      },\n      chartData: {\n        columns: ['type', 'count'],\n        rows: [{\n          type: '成功',\n          count: 0\n        }, {\n          type: '失败',\n          count: 0\n        }]\n      }\n    };\n  },\n  destroyed: function destroyed() {\n    // 关闭链接\n    if (this.websocket) {\n      this.websocket.close();\n    }\n  },\n  watch: {\n    total_count: function total_count(val) {\n      this.chartExtend.graphic[0].style.text = val;\n    }\n  },\n  methods: {\n    initWebSocket: function initWebSocket() {\n      var baseUri = process.env.VUE_APP_BASE_URL;\n      var uri = \"\".concat(baseUri.replace('http', 'ws'), \"ws/message\");\n      this.websocket = new WebSocket(uri);\n      this.websocket.onmessage = this.websocketOnMessage;\n      this.websocket.onopen = this.websocketOnOpen;\n      this.websocket.onerror = this.websocketOnError;\n      this.websocket.onclose = this.websocketClose;\n    },\n    websocketOnOpen: function websocketOnOpen() {\n      console.log('建立websocket连接');\n    },\n    websocketOnError: function websocketOnError() {\n      // 连接建立失败重连\n      this.initWebSocket();\n    },\n    websocketOnMessage: function () {\n      var _websocketOnMessage = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        var _e$data$split, _e$data$split2, type, id;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // 数据接收\n                console.log(e.data);\n                _e$data$split = e.data.split('_'), _e$data$split2 = _slicedToArray(_e$data$split, 2), type = _e$data$split2[0], id = _e$data$split2[1];\n\n                if (!(type !== 'pressure')) {\n                  _context.next = 4;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 4:\n                if (!(Number(id) !== this.param.case_id)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 6:\n                this.websocket.close();\n                this.loading = false;\n                _context.next = 10;\n                return this.getReportDetail();\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function websocketOnMessage(_x) {\n        return _websocketOnMessage.apply(this, arguments);\n      }\n\n      return websocketOnMessage;\n    }(),\n    websocketSend: function websocketSend(data) {\n      // 数据发送\n      this.websocket.send(data);\n    },\n    websocketClose: function websocketClose(e) {\n      // 关闭\n      console.log('断开连接', e);\n      this.loading = false;\n    },\n    doExecute: function () {\n      var _doExecute = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.loading = true;\n                this.initWebSocket();\n                _context2.next = 4;\n                return Pressure.execute(this.param);\n\n              case 4:\n                this.report_id = _context2.sent;\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function doExecute() {\n        return _doExecute.apply(this, arguments);\n      }\n\n      return doExecute;\n    }(),\n    dialogClose: function () {\n      var _dialogClose = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this.dialog_visible = false;\n                this.param.case_id = this.case_info.id;\n                _context3.next = 4;\n                return this.getReportList();\n\n              case 4:\n                _context3.next = 6;\n                return this.getReportDetail();\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function dialogClose() {\n        return _dialogClose.apply(this, arguments);\n      }\n\n      return dialogClose;\n    }(),\n    getReportList: function () {\n      var _getReportList = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4() {\n        var res, firstId;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return Pressure.getReportIdList(this.param.case_id);\n\n              case 2:\n                res = _context4.sent;\n                this.report_list = res;\n\n                if (!(res.length === 0)) {\n                  _context4.next = 6;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\");\n\n              case 6:\n                firstId = res[0];\n                this.report_id = firstId;\n\n              case 8:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function getReportList() {\n        return _getReportList.apply(this, arguments);\n      }\n\n      return getReportList;\n    }(),\n    getReportDetail: function () {\n      var _getReportDetail = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!(this.report_id === null)) {\n                  _context5.next = 2;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\");\n\n              case 2:\n                _context5.next = 4;\n                return Pressure.getReportDetail(this.report_id);\n\n              case 4:\n                res = _context5.sent;\n                this.dataInit(res);\n\n              case 6:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function getReportDetail() {\n        return _getReportDetail.apply(this, arguments);\n      }\n\n      return getReportDetail;\n    }(),\n    dataInit: function dataInit(res) {\n      this.table_data = [];\n      var pass_count = res.pass_count,\n          error_count = res.error_count,\n          result = res.result;\n      this.table_data.push(res);\n      this.total_count = pass_count + error_count;\n      this.chartExtend.graphic[0].style.text = pass_count + error_count;\n      res.count = this.total_count;\n      this.chartData.rows[0].count = pass_count;\n      this.chartData.rows[1].count = error_count;\n      this.result_list = result.slice();\n    },\n    getCaseDetail: function getCaseDetail(caseInfo) {\n      this.case_choose = true;\n      this.result_list.forEach(function (e) {\n        e.is_choose = false;\n      });\n      caseInfo.is_choose = true;\n      this.case_detail = caseInfo;\n    }\n  }\n};",null]}