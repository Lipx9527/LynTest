{"remainingRequest":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/thread-loader/dist/cjs.js!/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/babel-loader/lib/index.js!/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/lyn/Desktop/lyntest/lyntest-vue/src/component/notify/observer.js","dependencies":[{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/src/component/notify/observer.js","mtime":1606834545487},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n/* eslint-disable*/\nimport Emitter from './emitter';\n\nvar _default =\n/*#__PURE__*/\nfunction () {\n  function _default(connectionUrl) {\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, _default);\n\n    this.format = opts.format && opts.format.toLowerCase();\n\n    if (connectionUrl.startsWith('//')) {\n      var scheme = window.location.protocol === 'https:' ? 'wss' : 'ws';\n      connectionUrl = \"\".concat(scheme, \":\").concat(connectionUrl);\n    }\n\n    this.connectionUrl = connectionUrl;\n    this.opts = opts;\n    this.reconnection = this.opts.reconnection || false;\n    this.reconnectionAttempts = this.opts.reconnectionAttempts || Infinity;\n    this.reconnectionDelay = this.opts.reconnectionDelay || 1000;\n    this.reconnectTimeoutId = 0;\n    this.reconnectionCount = 0;\n    this.passToStoreHandler = this.opts.passToStoreHandler || false;\n    this.connect(connectionUrl, opts);\n\n    if (opts.store) {\n      this.store = opts.store;\n    }\n\n    if (opts.mutations) {\n      this.mutations = opts.mutations;\n    }\n\n    this.onEvent();\n  }\n\n  _createClass(_default, [{\n    key: \"connect\",\n    value: function connect(connectionUrl) {\n      var _this = this;\n\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var protocol = opts.protocol || '';\n      this.WebSocket = opts.WebSocket || (protocol === '' ? new WebSocket(connectionUrl) : new WebSocket(connectionUrl, protocol));\n\n      if (this.format === 'json') {\n        if (!('sendObj' in this.WebSocket)) {\n          this.WebSocket.sendObj = function (obj) {\n            return _this.WebSocket.send(JSON.stringify(obj));\n          };\n        }\n      }\n\n      return this.WebSocket;\n    }\n  }, {\n    key: \"reconnect\",\n    value: function reconnect() {\n      var _this2 = this;\n\n      if (this.reconnectionCount <= this.reconnectionAttempts) {\n        this.reconnectionCount++;\n        clearTimeout(this.reconnectTimeoutId);\n        this.reconnectTimeoutId = setTimeout(function () {\n          if (_this2.store) {\n            _this2.passToStore('SOCKET_RECONNECT', _this2.reconnectionCount);\n          }\n\n          _this2.connect(_this2.connectionUrl, _this2.opts);\n\n          _this2.onEvent();\n        }, this.reconnectionDelay);\n      } else if (this.store) {\n        this.passToStore('SOCKET_RECONNECT_ERROR', true);\n      }\n    }\n  }, {\n    key: \"onEvent\",\n    value: function onEvent() {\n      var _this3 = this;\n\n      ;\n      ['onmessage', 'onclose', 'onerror', 'onopen'].forEach(function (eventType) {\n        _this3.WebSocket[eventType] = function (event) {\n          Emitter.emit(eventType, event);\n\n          if (_this3.store) {\n            _this3.passToStore(\"SOCKET_\".concat(eventType), event);\n          }\n\n          if (_this3.reconnection && eventType === 'onopen') {\n            _this3.opts.$setInstance(event.currentTarget);\n\n            _this3.reconnectionCount = 0;\n          }\n\n          if (_this3.reconnection && eventType === 'onclose') {\n            _this3.reconnect();\n          }\n        };\n      });\n    }\n  }, {\n    key: \"passToStore\",\n    value: function passToStore(eventName, event) {\n      if (this.passToStoreHandler) {\n        this.passToStoreHandler(eventName, event, this.defaultPassToStore.bind(this));\n      } else {\n        this.defaultPassToStore(eventName, event);\n      }\n    }\n  }, {\n    key: \"defaultPassToStore\",\n    value: function defaultPassToStore(eventName, event) {\n      if (!eventName.startsWith('SOCKET_')) {\n        return;\n      }\n\n      var method = 'commit';\n      var target = eventName.toUpperCase();\n      var msg = event;\n\n      if (this.format === 'json' && event.data) {\n        msg = JSON.parse(event.data);\n\n        if (msg.mutation) {\n          target = [msg.namespace || '', msg.mutation].filter(function (e) {\n            return !!e;\n          }).join('/');\n        } else if (msg.action) {\n          method = 'dispatch';\n          target = [msg.namespace || '', msg.action].filter(function (e) {\n            return !!e;\n          }).join('/');\n        }\n      }\n\n      if (this.mutations) {\n        target = this.mutations[target] || target;\n      }\n\n      this.store[method](target, msg);\n    }\n  }]);\n\n  return _default;\n}();\n\nexport { _default as default };",null]}