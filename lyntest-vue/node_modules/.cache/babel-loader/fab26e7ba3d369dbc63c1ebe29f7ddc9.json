{"remainingRequest":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/thread-loader/dist/cjs.js!/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/babel-loader/lib/index.js!/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyn/Desktop/lyntest/lyntest-vue/src/view/admin/user/user-info.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/src/view/admin/user/user-info.vue","mtime":1608859526901},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/lyn/Desktop/lyntest/lyntest-vue/node_modules/@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Admin from '@/lin/model/admin';\nimport User from '@/lin/model/user';\nexport default {\n  props: {\n    submit: {\n      type: Boolean,\n      // 表单是否显示功能按钮\n      default: true\n    },\n    id: {\n      // 用户id\n      type: Number,\n      default: undefined\n    },\n    groups: {\n      // 所有分组\n      type: Array,\n      default: function _default() {}\n    },\n    labelPosition: {\n      // 表单label位置\n      type: String,\n      default: 'right'\n    },\n    info: {\n      // 用户信息\n      type: Object,\n      default: function _default() {}\n    },\n    pageType: {\n      type: String,\n      default: 'add' // 区分编辑页面/添加页面\n\n    }\n  },\n  inject: ['eventBus'],\n  data: function data() {\n    var _this = this;\n\n    // 验证回调函数\n    var checkUserName = function checkUserName(rule, value, callback) {\n      // eslint-disable-line\n      if (!value) {\n        callback(new Error('用户名不能为空'));\n      }\n\n      callback();\n    };\n\n    var validateCode = function validateCode(rule, value, callback) {\n      if (!value) {\n        callback(new Error('工号不能为空'));\n      }\n\n      callback();\n    };\n\n    var validatePassword = function validatePassword(rule, value, callback) {\n      if (value === '') {\n        callback(new Error('请输入密码'));\n      } else if (value.length < 6) {\n        callback(new Error('密码长度不能少于6位数'));\n      } else {\n        if (_this.form.checkPassword !== '') {\n          _this.$refs.form.validateField('confirm_password');\n        }\n\n        callback();\n      }\n    };\n\n    var validatePassword2 = function validatePassword2(rule, value, callback) {\n      if (value === '') {\n        callback(new Error('请再次输入密码'));\n      } else if (value !== _this.form.password) {\n        callback(new Error('两次输入密码不一致!'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      loading: false,\n      // 加载动画\n      isEdited: false,\n      // 能否编辑\n      form: {\n        username: '',\n        password: '',\n        confirm_password: '',\n        code: '',\n        group_ids: []\n      },\n      // 验证规则\n      rules: {\n        username: [{\n          validator: checkUserName,\n          trigger: ['blur', 'change'],\n          required: true\n        }],\n        password: [{\n          validator: validatePassword,\n          trigger: 'blur',\n          required: true\n        }],\n        confirm_password: [{\n          validator: validatePassword2,\n          trigger: 'blur',\n          required: true\n        }],\n        code: [{\n          validator: validateCode,\n          trigger: 'blur',\n          required: true\n        }]\n      }\n    };\n  },\n  methods: {\n    // 提交表单\n    submitForm: function () {\n      var _submitForm = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(formName) {\n        var _this2 = this;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.$refs[formName].validate(\n                /*#__PURE__*/\n                function () {\n                  var _ref = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee(valid) {\n                    var res;\n                    return _regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            if (!valid) {\n                              _context.next = 33;\n                              break;\n                            }\n\n                            if (!(_this2.pageType === 'add')) {\n                              _context.next = 16;\n                              break;\n                            }\n\n                            _context.prev = 2;\n                            _this2.loading = true;\n                            _context.next = 6;\n                            return User.register(_this2.form);\n\n                          case 6:\n                            res = _context.sent;\n\n                            if (res.code < window.MAX_SUCCESS_CODE) {\n                              _this2.loading = false;\n\n                              _this2.$message.success(\"\".concat(res.message));\n\n                              _this2.eventBus.$emit('addUser', true);\n\n                              _this2.resetForm(formName);\n                            }\n\n                            _context.next = 14;\n                            break;\n\n                          case 10:\n                            _context.prev = 10;\n                            _context.t0 = _context[\"catch\"](2);\n                            _this2.loading = false;\n\n                            if (_context.t0.data.code === 10073 || _context.t0.data.code === 10071) {\n                              _this2.$message.error(_context.t0.data.message);\n                            } else {\n                              _this2.$message.error('新增用户失败');\n                            }\n\n                          case 14:\n                            _context.next = 31;\n                            break;\n\n                          case 16:\n                            if (!(_this2.form.code === _this2.info.code && _this2.form.group_ids.sort().toString() === _this2.info.group_ids.sort().toString())) {\n                              _context.next = 19;\n                              break;\n                            }\n\n                            _this2.$emit('handleInfoResult', false);\n\n                            return _context.abrupt(\"return\");\n\n                          case 19:\n                            _context.prev = 19;\n                            _this2.loading = true;\n                            _context.next = 23;\n                            return Admin.updateOneUser(_this2.form.code, _this2.form.group_ids, _this2.id);\n\n                          case 23:\n                            res = _context.sent;\n                            _context.next = 30;\n                            break;\n\n                          case 26:\n                            _context.prev = 26;\n                            _context.t1 = _context[\"catch\"](19);\n                            _this2.loading = false;\n                            console.log(_context.t1);\n\n                          case 30:\n                            if (res.code < window.MAX_SUCCESS_CODE) {\n                              _this2.loading = false;\n\n                              _this2.$message.success(\"\".concat(res.message));\n\n                              _this2.$emit('handleInfoResult', true);\n                            } else {\n                              _this2.loading = false;\n\n                              _this2.$message.error(\"\".concat(res.message));\n                            }\n\n                          case 31:\n                            _context.next = 35;\n                            break;\n\n                          case 33:\n                            console.log('error submit!!');\n\n                            _this2.$message.error('请填写正确的信息');\n\n                          case 35:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee, null, [[2, 10], [19, 26]]);\n                  }));\n\n                  return function (_x2) {\n                    return _ref.apply(this, arguments);\n                  };\n                }());\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function submitForm(_x) {\n        return _submitForm.apply(this, arguments);\n      }\n\n      return submitForm;\n    }(),\n    // 重置表单\n    resetForm: function resetForm(formName) {\n      if (this.pageType === 'edit') {\n        this.setInfo();\n      } else {\n        this.form.group_ids = [];\n        this.$refs[formName].resetFields();\n      }\n    },\n    setInfo: function setInfo() {\n      console.log(this.info);\n      this.form.username = this.info.username;\n      this.form.code = this.info.code;\n      var temp = [];\n      this.info.group_ids.forEach(function (item) {\n        temp.push(item.id);\n      });\n      this.form.group_ids = temp;\n    }\n  },\n  created: function created() {\n    // 通过是否接收到数据来判断当前页面是添加数据还是编辑数据\n    if (this.pageType === 'edit') {\n      this.setInfo();\n      this.isEdited = true;\n    }\n  }\n};",null]}